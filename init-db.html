<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Initialisation Base de Donn√©es - CROUS R√©seau</title>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        .container {
            background: rgba(255, 255, 255, 0.1);
            padding: 30px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        h1 {
            text-align: center;
            margin-bottom: 30px;
            color: #fff;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        .step {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            margin: 15px 0;
            border-radius: 10px;
            border-left: 4px solid #4CAF50;
        }
        .step h3 {
            margin-top: 0;
            color: #4CAF50;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
            transition: background 0.3s;
        }
        button:hover {
            background: #45a049;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-weight: bold;
        }
        .success { background: rgba(76, 175, 80, 0.2); color: #4CAF50; }
        .error { background: rgba(244, 67, 54, 0.2); color: #f44336; }
        .info { background: rgba(33, 150, 243, 0.2); color: #2196F3; }
        .log {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ Initialisation Base de Donn√©es CROUS R√©seau</h1>
        
        <div class="step">
            <h3>üìã √âtape 1 : Configuration Firebase</h3>
            <p>V√©rification de la connexion √† Firebase...</p>
            <button onclick="testConnection()">üîó Tester la Connexion</button>
            <div id="connectionStatus"></div>
        </div>

        <div class="step">
            <h3>üë• √âtape 2 : Cr√©ation des Utilisateurs de Test</h3>
            <p>Cr√©er des comptes utilisateurs avec diff√©rents r√¥les</p>
            <button onclick="createTestUsers()" id="usersBtn" disabled>üë§ Cr√©er Utilisateurs Test</button>
            <div id="usersStatus"></div>
        </div>

        <div class="step">
            <h3>üìÅ √âtape 3 : Cr√©ation des B√¢timents</h3>
            <p>Ajouter des b√¢timents de test √† la base de donn√©es</p>
            <button onclick="createBuildings()" id="buildingsBtn" disabled>üè¢ Cr√©er B√¢timents</button>
            <div id="buildingsStatus"></div>
        </div>

        <div class="step">
            <h3>üîå √âtape 4 : Cr√©ation des √âquipements</h3>
            <p>Ajouter des commutateurs et points d'acc√®s</p>
            <button onclick="createEquipment()" id="equipmentBtn" disabled>‚ö° Cr√©er √âquipements</button>
            <div id="equipmentStatus"></div>
        </div>

        <div class="step">
            <h3>üîß √âtape 5 : Cr√©ation des Interventions</h3>
            <p>Ajouter des interventions de test</p>
            <button onclick="createInterventions()" id="interventionsBtn" disabled>üìù Cr√©er Interventions</button>
            <div id="interventionsStatus"></div>
        </div>

        <div class="step">
            <h3>üéØ √âtape 6 : Test Complet</h3>
            <p>V√©rifier que toutes les donn√©es sont cr√©√©es</p>
            <button onclick="testComplete()" id="testBtn" disabled>üß™ Test Complet</button>
            <div id="testStatus"></div>
        </div>

        <div class="log" id="log">
            <strong>üìù Journal d'initialisation :</strong><br>
            En attente de d√©marrage...
        </div>
    </div>

    <script>
        // Configuration Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyBloQQvcd1lMANCU5Frdv7XIFB6vLI74Pk",
            authDomain: "focus-melody-467918-u9.firebaseapp.com",
            projectId: "focus-melody-467918-u9",
            storageBucket: "focus-melody-467918-u9.firebasestorage.app",
            messagingSenderId: "289948248371",
            appId: "1:289948248371:web:089fc30fdeccb2beecf646",
            measurementId: "G-3BFXRCW10N"
        };

        // Initialiser Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        let buildingIds = [];
        let userIds = [];

        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logDiv.innerHTML += `<div class="status ${type}">[${timestamp}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        async function testConnection() {
            try {
                log('üîó Test de connexion Firebase...', 'info');
                const testDoc = await db.collection('test').add({
                    test: true,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });
                await testDoc.delete();
                log('‚úÖ Connexion Firebase r√©ussie !', 'success');
                document.getElementById('connectionStatus').innerHTML = '<div class="status success">‚úÖ Connexion √©tablie</div>';
                document.getElementById('usersBtn').disabled = false;
            } catch (error) {
                log(`‚ùå Erreur de connexion: ${error.message}`, 'error');
                document.getElementById('connectionStatus').innerHTML = '<div class="status error">‚ùå Erreur de connexion</div>';
            }
        }

        async function createTestUsers() {
            try {
                log('üë§ Cr√©ation des utilisateurs de test...', 'info');
                
                const users = [
                    {
                        displayName: 'Admin CROUS',
                        email: 'admin@crous.fr',
                        role: 'admin',
                        isActive: true
                    },
                    {
                        displayName: 'Superviseur R√©seau',
                        email: 'supervisor@crous.fr',
                        role: 'supervisor',
                        isActive: true
                    },
                    {
                        displayName: 'Technicien R√©seau',
                        email: 'technician@crous.fr',
                        role: 'technician',
                        isActive: true
                    }
                ];

                for (const user of users) {
                    const docRef = await db.collection('users').add({
                        ...user,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    userIds.push(docRef.id);
                    log(`‚úÖ Utilisateur cr√©√©: ${user.displayName} (${user.role})`, 'success');
                }

                document.getElementById('usersStatus').innerHTML = '<div class="status success">‚úÖ Utilisateurs cr√©√©s</div>';
                document.getElementById('buildingsBtn').disabled = false;
            } catch (error) {
                log(`‚ùå Erreur cr√©ation utilisateurs: ${error.message}`, 'error');
                document.getElementById('usersStatus').innerHTML = '<div class="status error">‚ùå Erreur cr√©ation utilisateurs</div>';
            }
        }

        async function createBuildings() {
            try {
                log('üè¢ Cr√©ation des b√¢timents...', 'info');
                
                const buildings = [
                    {
                        name: 'B√¢timent Principal - CROUS',
                        address: '123 Avenue des √âtudiants, 75001 Paris',
                        floors: 5,
                        description: 'B√¢timent principal du CROUS avec logements √©tudiants',
                        status: 'active'
                    },
                    {
                        name: 'R√©sidence Universitaire Sud',
                        address: '456 Boulevard de l\'Universit√©, 75014 Paris',
                        floors: 8,
                        description: 'R√©sidence moderne pour √©tudiants internationaux',
                        status: 'active'
                    },
                    {
                        name: 'Cit√© Universitaire Nord',
                        address: '789 Rue de la Science, 75018 Paris',
                        floors: 6,
                        description: 'Cit√© universitaire avec √©quipements sportifs',
                        status: 'active'
                    }
                ];

                for (const building of buildings) {
                    const docRef = await db.collection('buildings').add({
                        ...building,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    buildingIds.push(docRef.id);
                    log(`‚úÖ B√¢timent cr√©√©: ${building.name}`, 'success');
                }

                document.getElementById('buildingsStatus').innerHTML = '<div class="status success">‚úÖ B√¢timents cr√©√©s</div>';
                document.getElementById('equipmentBtn').disabled = false;
            } catch (error) {
                log(`‚ùå Erreur cr√©ation b√¢timents: ${error.message}`, 'error');
                document.getElementById('buildingsStatus').innerHTML = '<div class="status error">‚ùå Erreur cr√©ation b√¢timents</div>';
            }
        }

        async function createEquipment() {
            try {
                log('‚ö° Cr√©ation des √©quipements...', 'info');
                
                if (buildingIds.length === 0) {
                    throw new Error('Aucun b√¢timent cr√©√©');
                }

                const buildingId = buildingIds[0];

                // Cr√©er des commutateurs
                const switches = [
                    {
                        name: 'Switch Principal - B1',
                        model: 'Cisco Catalyst 2960',
                        ip: '192.168.1.1',
                        buildingId: buildingId,
                        status: 'online',
                        ports: 24
                    },
                    {
                        name: 'Switch √âtage 1 - B1',
                        model: 'Cisco Catalyst 2960',
                        ip: '192.168.1.2',
                        buildingId: buildingId,
                        status: 'online',
                        ports: 48
                    }
                ];

                for (const sw of switches) {
                    await db.collection('switches').add({
                        ...sw,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    log(`‚úÖ Commutateur cr√©√©: ${sw.name}`, 'success');
                }

                // Cr√©er des points d'acc√®s
                const accessPoints = [
                    {
                        name: 'AP-B1-RDC',
                        model: 'Ubiquiti UniFi AP-AC-Pro',
                        buildingId: buildingId,
                        status: 'online',
                        ssid: 'CROUS-WiFi'
                    },
                    {
                        name: 'AP-B1-ET1',
                        model: 'Ubiquiti UniFi AP-AC-Pro',
                        buildingId: buildingId,
                        status: 'online',
                        ssid: 'CROUS-WiFi'
                    }
                ];

                for (const ap of accessPoints) {
                    await db.collection('accessPoints').add({
                        ...ap,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    log(`‚úÖ Point d'acc√®s cr√©√©: ${ap.name}`, 'success');
                }

                document.getElementById('equipmentStatus').innerHTML = '<div class="status success">‚úÖ √âquipements cr√©√©s</div>';
                document.getElementById('interventionsBtn').disabled = false;
            } catch (error) {
                log(`‚ùå Erreur cr√©ation √©quipements: ${error.message}`, 'error');
                document.getElementById('equipmentStatus').innerHTML = '<div class="status error">‚ùå Erreur cr√©ation √©quipements</div>';
            }
        }

        async function createInterventions() {
            try {
                log('üìù Cr√©ation des interventions...', 'info');
                
                if (buildingIds.length === 0 || userIds.length === 0) {
                    throw new Error('B√¢timents ou utilisateurs manquants');
                }

                const buildingId = buildingIds[0];
                const technicianId = userIds[2]; // Technicien

                const interventions = [
                    {
                        title: 'Maintenance pr√©ventive - Switch principal',
                        description: 'Maintenance pr√©ventive du switch principal du b√¢timent 1',
                        buildingId: buildingId,
                        technicianId: technicianId,
                        status: 'completed',
                        priority: 'medium',
                        category: 'maintenance'
                    },
                    {
                        title: 'Remplacement AP d√©fectueux',
                        description: 'Remplacement du point d\'acc√®s AP-B1-ET1',
                        buildingId: buildingId,
                        technicianId: technicianId,
                        status: 'completed',
                        priority: 'high',
                        category: 'reparation'
                    }
                ];

                for (const intervention of interventions) {
                    await db.collection('interventions').add({
                        ...intervention,
                        date: new Date(),
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    log(`‚úÖ Intervention cr√©√©e: ${intervention.title}`, 'success');
                }

                document.getElementById('interventionsStatus').innerHTML = '<div class="status success">‚úÖ Interventions cr√©√©es</div>';
                document.getElementById('testBtn').disabled = false;
            } catch (error) {
                log(`‚ùå Erreur cr√©ation interventions: ${error.message}`, 'error');
                document.getElementById('interventionsStatus').innerHTML = '<div class="status error">‚ùå Erreur cr√©ation interventions</div>';
            }
        }

        async function testComplete() {
            try {
                log('üß™ Test complet de la base de donn√©es...', 'info');
                
                const collections = ['users', 'buildings', 'switches', 'accessPoints', 'interventions'];
                const results = {};

                for (const collection of collections) {
                    const snapshot = await db.collection(collection).get();
                    results[collection] = snapshot.size;
                    log(`üìä Collection ${collection}: ${snapshot.size} documents`, 'success');
                }

                const total = Object.values(results).reduce((a, b) => a + b, 0);
                log(`üéâ Test complet r√©ussi ! Total: ${total} documents cr√©√©s`, 'success');
                
                document.getElementById('testStatus').innerHTML = '<div class="status success">‚úÖ Test complet r√©ussi</div>';
                
                log('üöÄ Votre application est maintenant pr√™te !', 'success');
                log('üåê Acc√©dez √†: https://focus-melody-467918-u9.web.app', 'info');
                
            } catch (error) {
                log(`‚ùå Erreur test complet: ${error.message}`, 'error');
                document.getElementById('testStatus').innerHTML = '<div class="status error">‚ùå Erreur test complet</div>';
            }
        }
    </script>
</body>
</html>


