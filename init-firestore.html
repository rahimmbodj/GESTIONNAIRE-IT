<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Initialisation Firestore - CROUS R√©seau</title>
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, addDoc, doc, setDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        // Configuration Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyBloQQvcd1lMANCU5Frdv7XIFB6vLI74Pk",
            authDomain: "focus-melody-467918-u9.firebaseapp.com",
            projectId: "focus-melody-467918-u9",
            storageBucket: "focus-melody-467918-u9.firebasestorage.app",
            messagingSenderId: "289948248371",
            appId: "1:289948248371:web:089fc30fdeccb2beecf646",
            measurementId: "G-3BFXRCW10N"
        };

        // Initialiser Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Donn√©es des b√¢timents
        const buildings = [
            { id: 'B1', name: 'B√¢timent 1', location: 'Zone A', floors: 4, description: 'B√¢timent principal administratif' },
            { id: 'B2', name: 'B√¢timent 2', location: 'Zone B', floors: 3, description: 'B√¢timent r√©sidentiel' },
            { id: 'B3', name: 'B√¢timent 3', location: 'Zone C', floors: 4, description: 'B√¢timent acad√©mique' },
            { id: 'B4', name: 'B√¢timent 4', location: 'Zone D', floors: 3, description: 'B√¢timent de services' },
            { id: 'B5', name: 'B√¢timent 5', location: 'Zone E', floors: 4, description: 'B√¢timent de recherche' },
            { id: 'B6', name: 'B√¢timent 6', location: 'Zone F', floors: 3, description: 'B√¢timent culturel' },
            { id: 'B7', name: 'B√¢timent 7', location: 'Zone G', floors: 4, description: 'B√¢timent sportif' }
        ];

        // Donn√©es des switches
        const switches = [
            { id: 'S-B1-1', name: 'Switch B1-1', model: 'USW Pro 24 POE', version: '6.7.17', ip: '192.168.10.1', buildingId: 'B1', location: 'Salle serveur RDC', status: 'active' },
            { id: 'S-B1-2', name: 'Switch B1-2', model: 'USW Pro 24 POE', version: '6.7.17', ip: '192.168.10.2', buildingId: 'B1', location: 'Salle serveur RDC', status: 'active' },
            { id: 'S-B2-1', name: 'Switch B2-1', model: 'USW Pro 24 POE', version: '6.7.17', ip: '192.168.20.1', buildingId: 'B2', location: 'Salle serveur RDC', status: 'active' },
            { id: 'S-B2-2', name: 'Switch B2-2', model: 'USW Pro 24 POE', version: '6.7.17', ip: '192.168.20.2', buildingId: 'B2', location: 'Salle serveur RDC', status: 'active' },
            { id: 'S-B3-1', name: 'Switch B3-1', model: 'USW Pro 24 POE', version: '6.7.17', ip: '192.168.30.1', buildingId: 'B3', location: 'Salle serveur RDC', status: 'active' },
            { id: 'S-B3-2', name: 'Switch B3-2', model: 'USW Pro 24 POE', version: '6.7.17', ip: '192.168.30.2', buildingId: 'B3', location: 'Salle serveur RDC', status: 'active' },
            { id: 'S-B4-1', name: 'Switch B4-1', model: 'USW Pro 24 POE', version: '6.7.17', ip: '192.168.40.1', buildingId: 'B4', location: 'Salle serveur RDC', status: 'active' },
            { id: 'S-B4-2', name: 'Switch B4-2', model: 'USW Pro 24 POE', version: '6.7.17', ip: '192.168.40.2', buildingId: 'B4', location: 'Salle serveur RDC', status: 'active' },
            { id: 'S-B5-1', name: 'Switch B5-1', model: 'USW Pro 24 POE', version: '6.7.17', ip: '192.168.50.1', buildingId: 'B5', location: 'Salle serveur RDC', status: 'active' },
            { id: 'S-B5-2', name: 'Switch B5-2', model: 'USW Pro 24 POE', version: '6.7.17', ip: '192.168.50.2', buildingId: 'B5', location: 'Salle serveur RDC', status: 'active' },
            { id: 'S-B6-1', name: 'Switch B6-1', model: 'USW Pro 24 POE', version: '6.7.17', ip: '192.168.60.1', buildingId: 'B6', location: 'Salle serveur RDC', status: 'active' },
            { id: 'S-B6-2', name: 'Switch B6-2', model: 'USW Pro 24 POE', version: '6.7.17', ip: '192.168.60.2', buildingId: 'B6', location: 'Salle serveur RDC', status: 'active' },
            { id: 'S-B7-1', name: 'Switch B7-1', model: 'USW Pro 24 POE', version: '6.7.17', ip: '192.168.70.1', buildingId: 'B7', location: 'Salle serveur RDC', status: 'active' },
            { id: 'S-B7-2', name: 'Switch B7-2', model: 'USW Pro 24 POE', version: '6.7.17', ip: '192.168.70.2', buildingId: 'B7', location: 'Salle serveur RDC', status: 'active' }
        ];

        // Donn√©es des panneaux de brassage
        const patchPanels = [
            { id: 'PDB-B1-1', name: 'PDB1 B√¢timent 1', buildingId: 'B1', location: 'Salle serveur RDC', ports: 24, type: 'Cat6', status: 'active' },
            { id: 'PDB-B1-2', name: 'PDB2 B√¢timent 1', buildingId: 'B1', location: 'Salle serveur RDC', ports: 24, type: 'Cat6', status: 'active' },
            { id: 'PDB-B2-1', name: 'PDB1 B√¢timent 2', buildingId: 'B2', location: 'Salle serveur RDC', ports: 24, type: 'Cat6', status: 'active' },
            { id: 'PDB-B2-2', name: 'PDB2 B√¢timent 2', buildingId: 'B2', location: 'Salle serveur RDC', ports: 24, type: 'Cat6', status: 'active' },
            { id: 'PDB-B3-1', name: 'PDB1 B√¢timent 3', buildingId: 'B3', location: 'Salle serveur RDC', ports: 24, type: 'Cat6', status: 'active' },
            { id: 'PDB-B3-2', name: 'PDB2 B√¢timent 3', buildingId: 'B3', location: 'Salle serveur RDC', ports: 24, type: 'Cat6', status: 'active' },
            { id: 'PDB-B4-1', name: 'PDB1 B√¢timent 4', buildingId: 'B4', location: 'Salle serveur RDC', ports: 24, type: 'Cat6', status: 'active' },
            { id: 'PDB-B4-2', name: 'PDB2 B√¢timent 4', buildingId: 'B4', location: 'Salle serveur RDC', ports: 24, type: 'Cat6', status: 'active' },
            { id: 'PDB-B5-1', name: 'PDB1 B√¢timent 5', buildingId: 'B5', location: 'Salle serveur RDC', ports: 24, type: 'Cat6', status: 'active' },
            { id: 'PDB-B5-2', name: 'PDB2 B√¢timent 5', buildingId: 'B5', location: 'Salle serveur RDC', ports: 24, type: 'Cat6', status: 'active' },
            { id: 'PDB-B6-1', name: 'PDB1 B√¢timent 6', buildingId: 'B6', location: 'Salle serveur RDC', ports: 24, type: 'Cat6', status: 'active' },
            { id: 'PDB-B6-2', name: 'PDB2 B√¢timent 6', buildingId: 'B6', location: 'Salle serveur RDC', ports: 24, type: 'Cat6', status: 'active' },
            { id: 'PDB-B7-1', name: 'PDB1 B√¢timent 7', buildingId: 'B7', location: 'Salle serveur RDC', ports: 24, type: 'Cat6', status: 'active' },
            { id: 'PDB-B7-2', name: 'PDB2 B√¢timent 7', buildingId: 'B7', location: 'Salle serveur RDC', ports: 24, type: 'Cat6', status: 'active' }
        ];

        // Donn√©es des points d'acc√®s
        const accessPoints = [];
        let apId = 1;

        for (let b = 1; b <= 7; b++) {
            const levels = ['R', 'E1', 'E2', 'E3'];
            const apPerLevel = 6;
            let apCounter = 0;

            for (let l = 0; l < levels.length; l++) {
                for (let p = 1; p <= apPerLevel; p++) {
                    apCounter++;
                    const apName = `B${b}-${levels[l]}${p}`;
                    const buildingId = `B${b}`;

                    const isPdb1 = apCounter <= 12;
                    const connectedPdb = isPdb1 ? `PDB-B${b}-1` : `PDB-B${b}-2`;
                    const portNumber = isPdb1 ? apCounter : apCounter - 12;

                    accessPoints.push({
                        id: `AP-${apId}`,
                        name: apName,
                        mac: `AA:BB:CC:DD:EE:${10 + apId}`,
                        model: 'UAP AC-M-Pro',
                        version: '6.7.17',
                        ip: `192.168.${b}.${apId + 10}`,
                        buildingId: buildingId,
                        floor: levels[l],
                        location: `√âtage ${levels[l]}, Position ${p}`,
                        connectedTo: `${connectedPdb} - Port ${portNumber}`,
                        security: 'WPA2/WPA3',
                        status: 'active',
                        signalStrength: 'excellent',
                        connectedClients: Math.floor(Math.random() * 20) + 1
                    });

                    apId++;
                }
            }
        }

        // Donn√©es des interventions
        const interventions = [
            {
                buildingId: 'B1',
                date: '2024-01-15',
                description: 'Remplacement du point d\'acc√®s B1-R1 d√©fectueux. Signal faible d√©tect√©.',
                status: 'completed',
                priority: 'high',
                technician: 'Technicien Principal',
                duration: '2h',
                parts: ['UAP AC-M-Pro', 'C√¢ble Cat6']
            },
            {
                buildingId: 'B3',
                date: '2024-01-20',
                description: 'Diagnostic de connexion lent sur le PDB2. Nettoyage des connecteurs effectu√©.',
                status: 'completed',
                priority: 'medium',
                technician: 'Technicien Principal',
                duration: '1h30',
                parts: ['Connecteurs RJ45', 'Nettoyant']
            },
            {
                buildingId: 'B2',
                date: '2024-01-25',
                description: 'Mise √† jour du firmware du switch B2-1. Version 6.7.17 install√©e.',
                status: 'completed',
                priority: 'low',
                technician: 'Technicien Principal',
                duration: '45min',
                parts: []
            }
        ];

        // Fonction d'initialisation
        async function initializeFirestore() {
            try {
                console.log('üöÄ D√©but de l\'initialisation de Firestore...');
                
                // Ajouter les b√¢timents
                console.log('üìÅ Ajout des b√¢timents...');
                for (const building of buildings) {
                    await setDoc(doc(db, 'buildings', building.id), building);
                    console.log(`‚úÖ B√¢timent ajout√©: ${building.name}`);
                }

                // Ajouter les switches
                console.log('üîå Ajout des switches...');
                for (const switchItem of switches) {
                    await setDoc(doc(db, 'switches', switchItem.id), switchItem);
                    console.log(`‚úÖ Switch ajout√©: ${switchItem.name}`);
                }

                // Ajouter les panneaux de brassage
                console.log('üîó Ajout des panneaux de brassage...');
                for (const panel of patchPanels) {
                    await setDoc(doc(db, 'patchPanels', panel.id), panel);
                    console.log(`‚úÖ Panneau ajout√©: ${panel.name}`);
                }

                // Ajouter les points d'acc√®s
                console.log('üì∂ Ajout des points d\'acc√®s...');
                for (const ap of accessPoints) {
                    await setDoc(doc(db, 'accessPoints', ap.id), ap);
                    console.log(`‚úÖ Point d'acc√®s ajout√©: ${ap.name}`);
                }

                // Ajouter les interventions
                console.log('üìã Ajout des interventions...');
                for (const intervention of interventions) {
                    await addDoc(collection(db, 'interventions'), intervention);
                    console.log(`‚úÖ Intervention ajout√©e: ${intervention.description.substring(0, 50)}...`);
                }

                console.log('üéâ Initialisation termin√©e avec succ√®s !');
                document.getElementById('status').innerHTML = `
                    <div style="color: green; font-weight: bold;">
                        ‚úÖ Initialisation termin√©e avec succ√®s !<br>
                        üìä ${buildings.length} b√¢timents<br>
                        üîå ${switches.length} switches<br>
                        üîó ${patchPanels.length} panneaux de brassage<br>
                        üì∂ ${accessPoints.length} points d'acc√®s<br>
                        üìã ${interventions.length} interventions
                    </div>
                `;

            } catch (error) {
                console.error('‚ùå Erreur lors de l\'initialisation:', error);
                document.getElementById('status').innerHTML = `
                    <div style="color: red; font-weight: bold;">
                        ‚ùå Erreur lors de l'initialisation:<br>
                        ${error.message}
                    </div>
                `;
            }
        }

        // Exposer la fonction globalement
        window.initializeFirestore = initializeFirestore;
    </script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }
        .info {
            background: #e8f4fd;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #3498db;
        }
        .warning {
            background: #fff3cd;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #ffc107;
        }
        button {
            background: #3498db;
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
            width: 100%;
            margin-bottom: 20px;
        }
        button:hover {
            background: #2980b9;
        }
        button:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
        }
        #status {
            margin-top: 20px;
            padding: 20px;
            border-radius: 8px;
            background: #f8f9fa;
            border: 1px solid #dee2e6;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        .stat-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid #dee2e6;
        }
        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #3498db;
        }
        .stat-label {
            color: #6c757d;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ Initialisation Firestore - CROUS R√©seau</h1>
        
        <div class="info">
            <h3>üìã Ce script va cr√©er :</h3>
            <ul>
                <li><strong>7 b√¢timents</strong> avec leurs informations d√©taill√©es</li>
                <li><strong>14 switches</strong> (2 par b√¢timent) avec configurations r√©seau</li>
                <li><strong>14 panneaux de brassage</strong> (2 par b√¢timent) avec 24 ports chacun</li>
                <li><strong>168 points d'acc√®s</strong> (24 par b√¢timent) avec nomenclature B1-R1, B1-E11, etc.</li>
                <li><strong>3 interventions</strong> d'exemple avec historique</li>
            </ul>
        </div>

        <div class="warning">
            <h3>‚ö†Ô∏è Attention :</h3>
            <p>Ce script va <strong>√©craser</strong> toutes les donn√©es existantes dans les collections Firestore. Assurez-vous d'avoir sauvegard√© vos donn√©es importantes.</p>
        </div>

        <button onclick="initializeFirestore()" id="initBtn">
            üöÄ Initialiser la Base de Donn√©es
        </button>

        <div class="stats">
            <div class="stat-card">
                <div class="stat-number">7</div>
                <div class="stat-label">B√¢timents</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">14</div>
                <div class="stat-label">Switches</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">14</div>
                <div class="stat-label">Panneaux</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">168</div>
                <div class="stat-label">Points d'acc√®s</div>
            </div>
        </div>

        <div id="status">
            <p>Cliquez sur le bouton pour initialiser la base de donn√©es...</p>
        </div>
    </div>
</body>
</html>
